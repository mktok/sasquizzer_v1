<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SAS Quizzer by MKTOK</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>


  /* Chrome / Safari scrollbar styling */
  #qButtonsWrapper::-webkit-scrollbar {
    height: 6px;
  }
  #qButtonsWrapper::-webkit-scrollbar-track {
    background: #1f2937;
    border-radius: 8px;
  }
  #qButtonsWrapper::-webkit-scrollbar-thumb {
    background-color: #38bdf8;
    border-radius: 8px;
  }
  #qButtonsWrapper::-webkit-scrollbar-thumb:hover {
    background-color: #0ea5e9;
  }

/* @media (max-width: 640px) {
  #qButtonsContainer button { padding: 0.35rem 0.55rem; font-size: 0.8rem; }
} */

</style>
</head>

<body class="h-full flex flex-col bg-gray-900 text-gray-100 transition-colors duration-500">

  <!-- Header with Back Button -->
  <header class="flex items-center justify-between px-4 py-3 bg-gray-800 border-b border-gray-700 sticky top-0 z-50">
    <button id="backButton" class="text-sky-400 hover:text-sky-300 font-semibold text-lg transition">
      ← Back
    </button>

    <a class="text-2xl font-bold text-sky-400 text-center flex-grow" href="/sasquizzer_v1/">SAS Quizzer</a>

    <a id='listview' class="w-15 text-sky-400 hover:text-sky-300 font-semibold text-lg transition"> List View </a> <!-- spacer -->
  </header>

  <div class="flex justify-center items-start mt-4 pb-24 px-2">
    <div class="h-full w-full max-w-3xl">

      <!-- Quiz Title -->
      <div id="title" class="text-xl font-bold text-sky-400 text-center pb-3"></div>

      <!-- Status Message (only shown on error) -->
      <div id="status" class="hidden bg-red-700 text-white text-center py-2 text-sm rounded-lg"></div>

      <!-- Question Section -->
      <section class="bg-gray-700 shadow-md px-4 py-4 rounded-lg border-b border-gray-700">
        <div id="qnum" class="text-sky-400 font-bold mb-2">Question —</div>
        <div id="question" class="text-lg font-medium leading-snug">—</div>
      </section>

      <!-- Scrollable Options -->
      <main id="optsContainer" class="flex-grow overflow-y-auto px-2 py-3 mb-24 ">
        <div id="opts" class="grid gap-3"></div>
        <!-- Meta Info -->
        <div id="meta" class="hidden bg-sky-400 text-black px-3 py-2 mt-4 mb-24 rounded-lg font-small inline-block mb-2"></div>
      </main>

      
      


<!-- Navigation Buttons -->
<div
  class="fixed bottom-10 left-1/2 -translate-x-1/2 w-full max-w-3xl bg-gray-700 rounded-lg border-t border-gray-700 px-3 py-3 flex items-center gap-2 overflow-hidden">

  <!-- Prev Button -->
  <button id="prev"
    class="px-3 py-2 rounded-lg border border-gray-600 hover:bg-gray-600 flex-shrink-0">
    ◀
  </button>

  <!-- Scrollable Question Buttons -->
  <div id="qButtonsWrapper"
    class="flex-1 overflow-x-auto overflow-y-hidden flex scrollbar-thumb-sky-500 scrollbar-track-gray-800 scrollbar-thin space-x-2 px-1 py-1 rounded-lg">
    <div id="qButtonsContainer" class="flex flex-nowrap gap-2 min-w-max"></div>
  </div>

  <!-- Next Button -->
  <button id="next"
    class="px-3 py-2 rounded-lg bg-sky-500 text-black font-semibold hover:bg-sky-400 flex-shrink-0">
    ▶
  </button>
</div>




    </div>
  </div>

  <!-- Footer -->
  <footer
    class="fixed bottom-0 left-0 right-0 bg-gray-800 border-t border-gray-700 text-gray-400 text-xs text-center py-2 flex items-center justify-between px-3">
    <div>Use ← → keys and 1–4 to choose</div>
    <div>© 2025 SAS Quizzer by MKTOK</div>
  </footer>

  <script>
    // Back Button
    document.getElementById('backButton').addEventListener('click', () => window.history.go(-1));

    // URL Params
    const params = new URLSearchParams(window.location.search);
    const file = params.get('file');
    const type = params.get('type');
    const displayfield = params.get('displayfield');
    const CSV_PATH = `https://mktok.github.io/sasquizzer_v1/data/${type}/${file}`;

    // Elements
    const status = document.getElementById('status');
    const qnumEl = document.getElementById('qnum');
    const questionEl = document.getElementById('question');
    const optsEl = document.getElementById('opts');
    const prevBtn = document.getElementById('prev');
    const nextBtn = document.getElementById('next');
    const progressEl = document.getElementById('progress');
    const metaEl = document.getElementById('meta');
    const title = document.getElementById('title');
    const qButtonsContainer = document.getElementById('qButtonsContainer');


    const listviewEl = document.getElementById('listview');
    

    listviewEl.href = `allmcqs.html?file=${file}&type=${type}&displayfield=${encodeURIComponent(displayfield)}`;

    // Auto-scroll to keep active button visible
    


    title.textContent = displayfield || "MCQ Viewer";

    let questions = [];
    let idx = 0;

    function normalizeFields(fields) {
      fields = fields.map(f => typeof f === 'string' ? f.trim() : f);
      if (fields.length >= 6) {
        const answer = fields[5];
        const options = fields.slice(1, 5);
        return {
          question: fields[0],
          options,
          answer: (answer || '').trim().charAt(0).toUpperCase(),
          meta: fields[6] || ''
        };
      }
      return null;
    }

    function renderQuestionButtons() {
      qButtonsContainer.innerHTML = "";
      questions.forEach((_, i) => {
        const btn = document.createElement("button");
        btn.textContent = i + 1;
        btn.className = `px-3 py-1 mb-1 rounded-md text-sm font-semibold transition ${
          i === idx
            ? "bg-sky-500 text-black"
            : "bg-gray-800 text-gray-300 hover:bg-gray-600"
        }`;
        btn.onclick = () => {
          idx = i;
          render();
        };
        qButtonsContainer.appendChild(btn);
      });
    }

    function render() {
      if (!questions.length) {
        qnumEl.textContent = "No questions found";
        questionEl.textContent = "";
        optsEl.innerHTML = "";
        return;
      }

      const q = questions[idx];
      qnumEl.textContent = `Question ${idx + 1}`;
      questionEl.textContent = q.question;
      optsEl.innerHTML = "";

      q.options.forEach((opt, i) => {
        const btn = document.createElement("button");
        btn.className =
          "opt block w-full text-left px-4 py-3 rounded-lg border border-gray-700 bg-gray-700 hover:bg-gray-600 transition";
        btn.innerHTML = `<b>${String.fromCharCode(65 + i)}.</b> ${opt}`;
        btn.onclick = () => handleSelection(i);
        optsEl.appendChild(btn);
      });

      metaEl.classList.add("hidden");
      renderQuestionButtons();
      const activeBtn = qButtonsContainer.querySelector(".bg-sky-500");
        if (activeBtn) activeBtn.scrollIntoView({ behavior: "smooth", inline: "center", block: "nearest" });
    }

    function handleSelection(i) {
      const q = questions[idx];
      const correctIdx = q.answer.charCodeAt(0) - 65;
      const buttons = optsEl.children;

      for (let b = 0; b < buttons.length; b++) {
        buttons[b].disabled = true;
        buttons[b].classList.remove("bg-green-800", "bg-red-800", "text-white");
      }

 
      if (i === correctIdx) {
        buttons[i].classList.add('bg-green-800', 'text-white' , 'hover:bg-green-700', 'transition');
      } else {
        buttons[i].classList.add('bg-red-800', 'text-white', 'hover:bg-red-700',  'transition');
        if (buttons[correctIdx]) buttons[correctIdx].classList.add('bg-green-800', 'text-white', 'hover:bg-green-700','transition');
      }


      metaEl.classList.remove("hidden");
      metaEl.textContent = "Refer: " + (q.meta || "");
      renderQuestionButtons();
    }
    

    // Navigation
    prevBtn.onclick = () => {
      if (idx > 0) {
        idx--;
        render();
      }
    };
    nextBtn.onclick = () => {
      if (idx < questions.length - 1) {
        idx++;
        render();
      }
    };

    // Keyboard Shortcuts
    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowRight") nextBtn.click();
      if (e.key === "ArrowLeft") prevBtn.click();
      if (["1", "2", "3", "4"].includes(e.key)) {
        const n = parseInt(e.key) - 1;
        if (optsEl.children[n]) optsEl.children[n].click();
      }
    });

    

    // Load CSV
    Papa.parse(CSV_PATH, {
      download: true,
      skipEmptyLines: true,
      complete: function (res) {
        try {
          questions = res.data.map(normalizeFields).filter(Boolean);
          if (!questions.length) {
            status.textContent = "No valid questions found.";
            status.classList.remove("hidden");
            return;
          }
          render();
        } catch (err) {
          status.textContent = "Error parsing questions.";
          status.classList.remove("hidden");
        }
      },
      error: function (err) {
        status.textContent = "Error loading CSV file.";
        status.classList.remove("hidden");
        console.error(err);
      },
    });
  </script>
</body>
</html>

